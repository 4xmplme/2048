const e=new class{constructor(e){this.score=0,this.status="idle",this.board=e||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}_spawnNewTile(){let e=[];for(let t=0;t<this.board.length;t++)for(let s=0;s<this.board[t].length;s++)0===this.board[t][s]&&e.push({rowIndex:t,colIndex:s});if(0===e.length)return;let t=Math.floor(Math.random()*e.length),s=e[t],r=.1>Math.random()?4:2;this.board[s.rowIndex][s.colIndex]=r}_processRow(e){let t=e.filter(e=>0!==e),s=[];for(let e=0;e<t.length;e++)if(e+1<t.length&&t[e]===t[e+1]){let r=2*t[e];2048===r&&(this.status="win"),s.push(r),this.score+=r,e++}else s.push(t[e]);for(;s.length<4;)s.push(0);return s}_transposeBoard(){let e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(let t=0;t<e.length;t++)for(let s=0;s<e[t].length;s++)e[s][t]=this.board[t][s];return e}_checkForGameOver(){for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(0===this.board[e][t]||e<3&&this.board[e][t]===this.board[e+1][t]||t<3&&this.board[e][t]===this.board[e][t+1])return;this.status="lose"}move(e){if("game over"===this.status)return!1;let t=JSON.stringify(this.board);switch(e){case"Up":this.board=this._transposeBoard(),this.board=this.board.map(e=>this._processRow(e)),this.board=this._transposeBoard();break;case"Down":this.board=this._transposeBoard(),this.board=this.board.map(e=>this._processRow([...e].reverse()).reverse()),this.board=this._transposeBoard();break;case"Left":this.board=this.board.map(e=>this._processRow(e));break;case"Right":this.board=this.board.map(e=>this._processRow([...e].reverse()).reverse())}let s=JSON.stringify(this.board)!==t;return s&&(this._spawnNewTile(),this._checkForGameOver()),s}getScore(){return this.score}getState(){return this.board}getStatus(){return this.status}start(){this.restart()}restart(){this.score=0,this.status="playing",this.board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this._spawnNewTile(),this._spawnNewTile()}},t=document.querySelector(".game-score"),s=document.querySelector(".button"),r=document.querySelector("tbody"),o=document.querySelector(".message-start"),a=document.querySelector(".message-win"),i=document.querySelector(".message-lose"),n=()=>{let s=e.getState(),o=e.getScore(),a=r.querySelectorAll("tr");t.textContent=o,a.forEach((e,t)=>{e.querySelectorAll("td").forEach((e,r)=>{let o=s[t][r];e.textContent=0===o?"":o,e.className=`field-cell field-cell--${o}`})})},h=()=>{let t=e.getStatus();o.classList.toggle("hidden","idle"!==t),a.classList.toggle("hidden","win"!==t),i.classList.toggle("hidden","lose"!==t),"playing"===t&&(s.textContent="Restart",s.className="button restart")},l=t=>{"lose"!==e.getStatus()&&e.move(t)&&(n(),h())};s.addEventListener("click",()=>{e.start(),n(),h()}),document.addEventListener("keydown",e=>{let t;switch(e.key){case"ArrowUp":t="Up";break;case"ArrowDown":t="Down";break;case"ArrowLeft":t="Left";break;case"ArrowRight":t="Right";break;default:return}e.preventDefault(),l(t)}),a.querySelector(".keep-playing").addEventListener("click",()=>{e.continuePlaying(),a.classList.add("hidden")});let c=0,d=0;const u=document.querySelector(".game-field");u.addEventListener("touchstart",e=>{e.preventDefault(),c=e.touches[0].clientX,d=e.touches[0].clientY},{passive:!1}),u.addEventListener("touchend",e=>{e.preventDefault();var t=e.changedTouches[0].clientX,s=e.changedTouches[0].clientY;let r=t-c,o=s-d;Math.abs(r)>Math.abs(o)?r>50?l("Right"):r<-50&&l("Left"):o>50?l("Down"):o<-50&&l("Up")});
//# sourceMappingURL=2048.4e8ec634.js.map
